<div class="container">
      <!-- ğŸŸ¦ Card de InformaciÃ³n -->
  <!-- <div class="info-card">
    <h2>{{ cuestionario?.titulo_cuestionario }}</h2>
    <p><strong>Tema:</strong> {{ cuestionario?.nom_tema }}</p>
  </div> -->
  <!-- Formulario lado izquierdo -->
   <!-- <div class="cuestionario" *ngIf="cuestionario.tiene_preguntas === 1">
       <div class="pregunta-card" *ngFor="let p of cuestionariCompleto.preguntas; let i = index">
    <h3>{{ i+1 }}. {{ p.enunciado_pregunta }}</h3>

    <div class="opciones">
      <div *ngFor="let o of p.opciones; let j = index">       
        <label>
           {{ letras[j] }}.
          <input 
            type="radio" 
            *ngIf="p.tipo_pregunta === 'OU'"
            name="pregunta{{p.id_pregunta}}"
            [value]="o.id_opcion"
          />
          <input 
            type="checkbox" 
            *ngIf="p.tipo_pregunta === 'OM'"
            [value]="o.id_opcion"
          />
          {{ o.texto_opcion }}
        </label>
      </div>
    </div>

    <small class="feedback">ğŸ’¡ {{ p.feedback_pregunta }}</small>
  </div>
   </div> -->
   <div>
      <div class="form-preview-wrapper" >
      <div class="form-section" *ngIf="preguntasGuardadas.length === 0">
    <h2>Crear Pregunta</h2>

    <form [formGroup]="preguntaForm" (ngSubmit)="guardarPregunta()">
        <label for="competencia" class="form-label">Competencia</label>
        <select id="competencia" formControlName="competencia" >
        <option value="">-- Selecciona una Competencia --</option>
        <option *ngFor="let co of competencias" [ngValue]="{ id: co.id_competencia, nombre: co.nom_competencia }">{{ co.nom_competencia }}</option>
        </select>
        <label for="subCompetencia" class="form-label">Sub Competencia</label>
        <select id="subCompetencia" formControlName="subCompetencia" >
        <option value="">-- Selecciona un tema --</option>
        <option *ngFor="let s of subCompetencias" [ngValue]="{ id: s.id_sub_compe, cod: s.cod_sub_compe, nombre: s.descripcion_sub_compe }">
         {{ s.cod_sub_compe }} - {{ s.descripcion_sub_compe | slice:0:50 }}{{ s.descripcion_sub_compe.length > 50 ? '...' : '' }}</option>
        </select>
        <label for="id_tema" class="form-label">Temas</label>
        <select id="id_tema" formControlName="id_tema" >
        <option value="">-- Selecciona un tema --</option>
        <option *ngFor="let t of temas" [ngValue]="{ id: t.id_tema, cod: t.cod_tema, nombre: t.descripcion_tema }">
         {{ t.cod_tema }} - {{ t.descripcion_tema | slice:0:50 }}{{ t.descripcion_tema.length > 50 ? '...' : '' }}</option>
        </select>
        <div>
            <label>Enunciado</label>
            <textarea formControlName="enunciado" placeholder="Escribe la pregunta..."></textarea>
        </div>

        <label>Tipo de Pregunta</label>
        <select formControlName="tipo">
        <option *ngFor="let t of tipos" [value]="t.value">{{ t.label }}</option>
        </select>

        <label>Feedback</label>
        <textarea formControlName="feedback" placeholder="Escribe la retroalimentaciÃ³n..."></textarea>

         <!-- Opciones dinÃ¡micas (solo si no es abierta) -->
        <div *ngIf="preguntaForm.get('tipo')?.value !== 'abierta'">
        <h3>Opciones</h3>
        <button type="button" (click)="addOpcion()">+ Agregar OpciÃ³n</button>

        <div formArrayName="opciones">        
            <tr *ngFor="let opcion of opciones.controls; let i = index" [formGroupName]="i">
                <td class="opcion-row">
                    <input type="text" formControlName="texto" placeholder="Texto de la opciÃ³n" />
                    <label>
                    <input type="checkbox" formControlName="es_correcta" />
                    Correcta
                    </label>
                    <button type="button" (click)="removeOpcion(i)">âŒ</button>
                </td>
            </tr>
        </div>
        </div>

        
        <button type="submit" [disabled]="preguntaForm.invalid">ğŸ’¾ Guardar Pregunta</button>
    </form>
  </div>

  <!-- Vista previa lado derecho -->
  <div class="preview-section" *ngIf="preguntasGuardadas.length === 1"> 
    <h2>Vista Previa</h2>
    <div class="info-card">
      <div *ngIf="competencias && competencias.length > 0; else cargando">
      <p>Competencia: {{ preguntasGuardadas[0].competencia.nombre}}</p>
    </div>
    <div *ngIf="competencias && competencias.length > 0; else cargando">
      <p>Sub Competencia: {{ preguntasGuardadas[0].subCompetencia.cod }} 
        {{ preguntasGuardadas[0].subCompetencia.nombre | slice:0:50 }}
       {{ preguntasGuardadas[0].subCompetencia.nombre.length > 50 ? '...........' : '' }}</p>
    </div>
    <div *ngIf="competencias && competencias.length > 0; else cargando">
      <p>Tema: {{ preguntasGuardadas[0].id_tema.cod }} 
        {{ preguntasGuardadas[0].id_tema.nombre | slice:0:50 }}
       {{ preguntasGuardadas[0].id_tema.nombre.length > 50 ? '...........' : '' }}</p>
    </div>

    <ng-template #cargando>
      <p>Cargando competencias...</p>
    </ng-template>
    </div>
    <div *ngFor="let pregunta of preguntasGuardadas; let i = index" class="preview-card">
      <h3>{{ i + 1 }}. {{ pregunta.enunciado }}</h3>
      <ul>
        <li *ngFor="let opcion of pregunta.opciones">
          <strong [style.color]="opcion.es_correcta ? 'green' : 'black'">
            {{ opcion.texto }}
          </strong>
        </li>
      </ul>
      <div>
        <strong>Feedback</strong>
        <h5 class="preview-feedback">{{pregunta.feedback}}</h5>
      </div>
      <button type="button" class="btn-eliminar" (click)="eliminarPregunta(i)">ğŸ—‘ Eliminar</button>
    </div>
  <button type="button" class="btn success save-btn" (click)="guardarPreguntasBD()" [disabled]="btnGuardarBD">
    ğŸ’¾ Guardar Cuestionario
  </button>
  </div> 
 </div>
   </div>
 
</div>
